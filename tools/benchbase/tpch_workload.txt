select l_returnflag, l_linestatus, sum(l_quantity) as sum_qty, sum(l_extendedprice) as sum_base_price, sum(l_extendedprice * (1 - l_discount)) as sum_disc_price, sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge, avg(l_quantity) as avg_qty, avg(l_extendedprice) as avg_price, avg(l_discount) as avg_disc, count(*) as count_order from lineitem where l_shipdate <= date '1998-12-01' - concat('61',' day')::interval group by l_returnflag, l_linestatus order by l_returnflag, l_linestatus;
select l_returnflag, l_linestatus, sum(l_quantity) as sum_qty, sum(l_extendedprice) as sum_base_price, sum(l_extendedprice * (1 - l_discount)) as sum_disc_price, sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge, avg(l_quantity) as avg_qty, avg(l_extendedprice) as avg_price, avg(l_discount) as avg_disc, count(*) as count_order from lineitem where l_shipdate <= date '1998-12-01' - concat('67',' day')::interval group by l_returnflag, l_linestatus order by l_returnflag, l_linestatus;
 SELECT
    s_acctbal,
    s_name,
    n_name,
    p_partkey,
    p_mfgr,
    s_address,
    s_phone,
    s_comment
 FROM
    part,
    supplier,
    partsupp,
    nation,
    region
 WHERE
    p_partkey = ps_partkey
    AND s_suppkey = ps_suppkey
    AND p_size = 3
    AND p_type LIKE '%COPPER'
    AND s_nationkey = n_nationkey
    AND n_regionkey = r_regionkey
    AND r_name = 'EUROPE'
    AND ps_supplycost =
    (
       SELECT
          MIN(ps_supplycost)
       FROM
          partsupp,
          supplier,
          nation,
          region
       WHERE
          p_partkey = ps_partkey
          AND s_suppkey = ps_suppkey
          AND s_nationkey = n_nationkey
          AND n_regionkey = r_regionkey
          AND r_name = 'EUROPE'
    )
 ORDER BY
    s_acctbal DESC,
    n_name,
    s_name,
    p_partkey LIMIT 100
;
 SELECT
    s_acctbal,
    s_name,
    n_name,
    p_partkey,
    p_mfgr,
    s_address,
    s_phone,
    s_comment
 FROM
    part,
    supplier,
    partsupp,
    nation,
    region
 WHERE
    p_partkey = ps_partkey
    AND s_suppkey = ps_suppkey
    AND p_size = 4
    AND p_type LIKE '%NICKEL'
    AND s_nationkey = n_nationkey
    AND n_regionkey = r_regionkey
    AND r_name = 'ASIA'
    AND ps_supplycost =
    (
       SELECT
          MIN(ps_supplycost)
       FROM
          partsupp,
          supplier,
          nation,
          region
       WHERE
          p_partkey = ps_partkey
          AND s_suppkey = ps_suppkey
          AND s_nationkey = n_nationkey
          AND n_regionkey = r_regionkey
          AND r_name = 'ASIA'
    )
 ORDER BY
    s_acctbal DESC,
    n_name,
    s_name,
    p_partkey LIMIT 100
;
select l_orderkey, sum(l_extendedprice * (1 - l_discount)) as revenue, o_orderdate, o_shippriority from customer, orders, lineitem where c_mktsegment = 'BUILDING' and c_custkey = o_custkey and l_orderkey = o_orderkey and o_orderdate < '1995-03-21 +08'::date and l_shipdate > '1995-03-21 +08'::date group by l_orderkey, o_orderdate, o_shippriority order by revenue desc, o_orderdate limit 10;
select l_orderkey, sum(l_extendedprice * (1 - l_discount)) as revenue, o_orderdate, o_shippriority from customer, orders, lineitem where c_mktsegment = 'MACHINERY' and c_custkey = o_custkey and l_orderkey = o_orderkey and o_orderdate < '1995-03-21 +08'::date and l_shipdate > '1995-03-21 +08'::date group by l_orderkey, o_orderdate, o_shippriority order by revenue desc, o_orderdate limit 10;
select o_orderpriority, count(*) as order_count from orders where o_orderdate >= '1994-09-01 +08'::date and o_orderdate < '1994-09-01 +08'::date + interval '3' month and exists ( select * from lineitem where l_orderkey = o_orderkey and l_commitdate < l_receiptdate ) group by o_orderpriority order by o_orderpriority;
select o_orderpriority, count(*) as order_count from orders where o_orderdate >= '1996-05-01 +08'::date and o_orderdate < '1996-05-01 +08'::date + interval '3' month and exists ( select * from lineitem where l_orderkey = o_orderkey and l_commitdate < l_receiptdate ) group by o_orderpriority order by o_orderpriority;
select n_name, sum(l_extendedprice * (1 - l_discount)) as revenue from customer, orders, lineitem, supplier, nation, region where c_custkey = o_custkey and l_orderkey = o_orderkey and l_suppkey = s_suppkey and c_nationkey = s_nationkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'AMERICA' and o_orderdate >= '1994-01-01 +08'::date and o_orderdate < '1994-01-01 +08'::date + interval '1' year group by n_name order by revenue desc;
select n_name, sum(l_extendedprice * (1 - l_discount)) as revenue from customer, orders, lineitem, supplier, nation, region where c_custkey = o_custkey and l_orderkey = o_orderkey and l_suppkey = s_suppkey and c_nationkey = s_nationkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'AFRICA' and o_orderdate >= '1993-01-01 +08'::date and o_orderdate < '1993-01-01 +08'::date + interval '1' year group by n_name order by revenue desc;
select sum(l_extendedprice * l_discount) as revenue from lineitem where l_shipdate >= '1994-01-01 +08'::date and l_shipdate < '1994-01-01 +08'::date + interval '1' year and l_discount between '0.06'::decimal - 0.01 and '0.06'::decimal + 0.01 and l_quantity < 24;
select sum(l_extendedprice * l_discount) as revenue from lineitem where l_shipdate >= '1993-01-01 +08'::date and l_shipdate < '1993-01-01 +08'::date + interval '1' year and l_discount between '0.04'::decimal - 0.01 and '0.04'::decimal + 0.01 and l_quantity < 24;
SELECT
   supp_nation,
   cust_nation,
   l_year,
   SUM(volume) AS revenue
FROM
   (
      SELECT
         n1.n_name AS supp_nation,
         n2.n_name AS cust_nation,
         EXTRACT(YEAR
      FROM
         l_shipdate) AS l_year,
         l_extendedprice * (1 - l_discount) AS volume
      FROM
         supplier,
         lineitem,
         orders,
         customer,
         nation n1,
         nation n2
      WHERE
         s_suppkey = l_suppkey
         AND o_orderkey = l_orderkey
         AND c_custkey = o_custkey
         AND s_nationkey = n1.n_nationkey
         AND c_nationkey = n2.n_nationkey
         AND
         (
            (n1.n_name = 'RUSSIA' AND n2.n_name = 'KENYA')
            OR
            (n1.n_name = 'KENYA' AND n2.n_name = 'RUSSIA')
         )
         AND l_shipdate BETWEEN DATE '1995-01-01' AND DATE '1996-12-31'
   )
   AS shipping
GROUP BY
   supp_nation,
   cust_nation,
   l_year
ORDER BY
   supp_nation,
   cust_nation,
   l_year
;
SELECT
   supp_nation,
   cust_nation,
   l_year,
   SUM(volume) AS revenue
FROM
   (
      SELECT
         n1.n_name AS supp_nation,
         n2.n_name AS cust_nation,
         EXTRACT(YEAR
      FROM
         l_shipdate) AS l_year,
         l_extendedprice * (1 - l_discount) AS volume
      FROM
         supplier,
         lineitem,
         orders,
         customer,
         nation n1,
         nation n2
      WHERE
         s_suppkey = l_suppkey
         AND o_orderkey = l_orderkey
         AND c_custkey = o_custkey
         AND s_nationkey = n1.n_nationkey
         AND c_nationkey = n2.n_nationkey
         AND
         (
            (n1.n_name = 'UNITED STATES' AND n2.n_name = 'IRAQ')
            OR
            (n1.n_name = 'IRAQ' AND n2.n_name = 'UNITED STATES')
         )
         AND l_shipdate BETWEEN DATE '1995-01-01' AND DATE '1996-12-31'
   )
   AS shipping
GROUP BY
   supp_nation,
   cust_nation,
   l_year
ORDER BY
   supp_nation,
   cust_nation,
   l_year
;
SELECT
   o_year,
   SUM(
   CASE
      WHEN
         nation = 'UNITED KINGDOM'
      THEN
         volume
      ELSE
         0
   END
) / SUM(volume) AS mkt_share
FROM
   (
      SELECT
         EXTRACT(YEAR
      FROM
         o_orderdate) AS o_year,
         l_extendedprice * (1 - l_discount) AS volume,
         n2.n_name AS nation
      FROM
         part,
         supplier,
         lineitem,
         orders,
         customer,
         nation n1,
         nation n2,
         region
      WHERE
         p_partkey = l_partkey
         AND s_suppkey = l_suppkey
         AND l_orderkey = o_orderkey
         AND o_custkey = c_custkey
         AND c_nationkey = n1.n_nationkey
         AND n1.n_regionkey = r_regionkey
         AND r_name = 'EUROPE'
         AND s_nationkey = n2.n_nationkey
         AND o_orderdate BETWEEN DATE '1995-01-01' AND DATE '1996-12-31'
         AND p_type = 'ECONOMY POLISHED BRASS'
   )
   AS all_nations
GROUP BY
   o_year
ORDER BY
   o_year
;
SELECT
   o_year,
   SUM(
   CASE
      WHEN
         nation = 'ETHIOPIA'
      THEN
         volume
      ELSE
         0
   END
) / SUM(volume) AS mkt_share
FROM
   (
      SELECT
         EXTRACT(YEAR
      FROM
         o_orderdate) AS o_year,
         l_extendedprice * (1 - l_discount) AS volume,
         n2.n_name AS nation
      FROM
         part,
         supplier,
         lineitem,
         orders,
         customer,
         nation n1,
         nation n2,
         region
      WHERE
         p_partkey = l_partkey
         AND s_suppkey = l_suppkey
         AND l_orderkey = o_orderkey
         AND o_custkey = c_custkey
         AND c_nationkey = n1.n_nationkey
         AND n1.n_regionkey = r_regionkey
         AND r_name = 'AFRICA'
         AND s_nationkey = n2.n_nationkey
         AND o_orderdate BETWEEN DATE '1995-01-01' AND DATE '1996-12-31'
         AND p_type = 'SMALL ANODIZED BRASS'
   )
   AS all_nations
GROUP BY
   o_year
ORDER BY
   o_year
;
SELECT
   nation,
   o_year,
   SUM(amount) AS sum_profit
FROM
   (
      SELECT
         n_name AS nation,
         EXTRACT(YEAR
      FROM
         o_orderdate) AS o_year,
         l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity AS amount
      FROM
         part,
         supplier,
         lineitem,
         partsupp,
         orders,
         nation
      WHERE
         s_suppkey = l_suppkey
         AND ps_suppkey = l_suppkey
         AND ps_partkey = l_partkey
         AND p_partkey = l_partkey
         AND o_orderkey = l_orderkey
         AND s_nationkey = n_nationkey
         AND p_name LIKE '%honeydew%'
   )
   AS profit
GROUP BY
   nation,
   o_year
ORDER BY
   nation,
   o_year DESC
;
SELECT
   nation,
   o_year,
   SUM(amount) AS sum_profit
FROM
   (
      SELECT
         n_name AS nation,
         EXTRACT(YEAR
      FROM
         o_orderdate) AS o_year,
         l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity AS amount
      FROM
         part,
         supplier,
         lineitem,
         partsupp,
         orders,
         nation
      WHERE
         s_suppkey = l_suppkey
         AND ps_suppkey = l_suppkey
         AND ps_partkey = l_partkey
         AND p_partkey = l_partkey
         AND o_orderkey = l_orderkey
         AND s_nationkey = n_nationkey
         AND p_name LIKE '%olive%'
   )
   AS profit
GROUP BY
   nation,
   o_year
ORDER BY
   nation,
   o_year DESC
;
select c_custkey, c_name, sum(l_extendedprice * (1 - l_discount)) as revenue, c_acctbal, n_name, c_address, c_phone, c_comment from customer, orders, lineitem, nation where c_custkey = o_custkey and l_orderkey = o_orderkey and o_orderdate >= '1994-09-01 +08'::date and o_orderdate < '1994-09-01 +08'::date + interval '3' month and l_returnflag = 'R' and c_nationkey = n_nationkey group by c_custkey, c_name, c_acctbal, c_phone, n_name, c_address, c_comment order by revenue desc limit 20;
select c_custkey, c_name, sum(l_extendedprice * (1 - l_discount)) as revenue, c_acctbal, n_name, c_address, c_phone, c_comment from customer, orders, lineitem, nation where c_custkey = o_custkey and l_orderkey = o_orderkey and o_orderdate >= '1994-10-01 +08'::date and o_orderdate < '1994-10-01 +08'::date + interval '3' month and l_returnflag = 'R' and c_nationkey = n_nationkey group by c_custkey, c_name, c_acctbal, c_phone, n_name, c_address, c_comment order by revenue desc limit 20;
SELECT
   ps_partkey,
   SUM(ps_supplycost * ps_availqty) AS VALUE
FROM
   partsupp,
   supplier,
   nation
WHERE
   ps_suppkey = s_suppkey
   AND s_nationkey = n_nationkey
   AND n_name = 'ARGENTINA'
GROUP BY
   ps_partkey
HAVING
   SUM(ps_supplycost * ps_availqty) > (
   SELECT
      SUM(ps_supplycost * ps_availqty) * 0.001
   FROM
      partsupp, supplier, nation
   WHERE
      ps_suppkey = s_suppkey
      AND s_nationkey = n_nationkey
      AND n_name = 'ARGENTINA' )
   ORDER BY
      VALUE DESC
;
SELECT
   ps_partkey,
   SUM(ps_supplycost * ps_availqty) AS VALUE
FROM
   partsupp,
   supplier,
   nation
WHERE
   ps_suppkey = s_suppkey
   AND s_nationkey = n_nationkey
   AND n_name = 'INDIA'
GROUP BY
   ps_partkey
HAVING
   SUM(ps_supplycost * ps_availqty) > (
   SELECT
      SUM(ps_supplycost * ps_availqty) * 0.001
   FROM
      partsupp, supplier, nation
   WHERE
      ps_suppkey = s_suppkey
      AND s_nationkey = n_nationkey
      AND n_name = 'INDIA' )
   ORDER BY
      VALUE DESC
;
select l_shipmode, sum(case when o_orderpriority = '1-URGENT' or o_orderpriority = '2-HIGH' then 1 else 0 end) as high_line_count, sum(case when o_orderpriority <> '1-URGENT' and o_orderpriority <> '2-HIGH' then 1 else 0 end) as low_line_count from orders, lineitem where o_orderkey = l_orderkey and l_shipmode in ('AIR', 'TRUCK') and l_commitdate < l_receiptdate and l_shipdate < l_commitdate and l_receiptdate >= '1994-01-01 +08'::date and l_receiptdate < '1994-01-01 +08'::date + interval '1' year group by l_shipmode order by l_shipmode;
select l_shipmode, sum(case when o_orderpriority = '1-URGENT' or o_orderpriority = '2-HIGH' then 1 else 0 end) as high_line_count, sum(case when o_orderpriority <> '1-URGENT' and o_orderpriority <> '2-HIGH' then 1 else 0 end) as low_line_count from orders, lineitem where o_orderkey = l_orderkey and l_shipmode in ('AIR', 'TRUCK') and l_commitdate < l_receiptdate and l_shipdate < l_commitdate and l_receiptdate >= '1996-01-01 +08'::date and l_receiptdate < '1996-01-01 +08'::date + interval '1' year group by l_shipmode order by l_shipmode;
SELECT
   c_count,
   COUNT(*) AS custdist
FROM
   (
      SELECT
         c_custkey,
         COUNT(o_orderkey) AS c_count
      FROM
         customer
         LEFT OUTER JOIN
            orders
            ON c_custkey = o_custkey
            AND o_comment NOT LIKE '%unusual%accounts%'
      GROUP BY
         c_custkey
   )
   AS c_orders
GROUP BY
   c_count
ORDER BY
   custdist DESC,
   c_count DESC
;
SELECT
   c_count,
   COUNT(*) AS custdist
FROM
   (
      SELECT
         c_custkey,
         COUNT(o_orderkey) AS c_count
      FROM
         customer
         LEFT OUTER JOIN
            orders
            ON c_custkey = o_custkey
            AND o_comment NOT LIKE '%express%deposits%'
      GROUP BY
         c_custkey
   )
   AS c_orders
GROUP BY
   c_count
ORDER BY
   custdist DESC,
   c_count DESC
;
select 100.00 * sum(case when p_type like 'PROMO%' then l_extendedprice * (1 - l_discount) else 0 end) / sum(l_extendedprice * (1 - l_discount)) as promo_revenue from lineitem, part where l_partkey = p_partkey and l_shipdate >= '1997-01-01 +08'::date and l_shipdate < '1997-01-01 +08'::date + interval '1' month;
select 100.00 * sum(case when p_type like 'PROMO%' then l_extendedprice * (1 - l_discount) else 0 end) / sum(l_extendedprice * (1 - l_discount)) as promo_revenue from lineitem, part where l_partkey = p_partkey and l_shipdate >= '1994-09-01 +08'::date and l_shipdate < '1994-09-01 +08'::date + interval '1' month;
SELECT
   s_suppkey,
   s_name,
   s_address,
   s_phone,
   total_revenue
FROM
   supplier,
   revenue0
WHERE
   s_suppkey = supplier_no
   AND total_revenue = (
      SELECT
         MAX(total_revenue)
      FROM
         revenue0
   )
ORDER BY
   s_suppkey
;
SELECT
   s_suppkey,
   s_name,
   s_address,
   s_phone,
   total_revenue
FROM
   supplier,
   revenue0
WHERE
   s_suppkey = supplier_no
   AND total_revenue = (
      SELECT
         MAX(total_revenue)
      FROM
         revenue0
   )
ORDER BY
   s_suppkey
;
SELECT
   p_brand,
   p_type,
   p_size,
   COUNT(DISTINCT ps_suppkey) AS supplier_cnt
FROM
   partsupp,
   part
WHERE
   p_partkey = ps_partkey
   AND p_brand <> 'Brand#31'
   AND p_type NOT LIKE 'PROMO POLISHED%'
   AND p_size IN (7, 19, 6, 28, 40, 35, 25, 16)
   AND ps_suppkey NOT IN
   (
      SELECT
         s_suppkey
      FROM
         supplier
      WHERE
         s_comment LIKE '%Customer%Complaints%'
   )
GROUP BY
   p_brand,
   p_type,
   p_size
ORDER BY
   supplier_cnt DESC,
   p_brand,
   p_type,
   p_size
;
SELECT
   p_brand,
   p_type,
   p_size,
   COUNT(DISTINCT ps_suppkey) AS supplier_cnt
FROM
   partsupp,
   part
WHERE
   p_partkey = ps_partkey
   AND p_brand <> 'Brand#21'
   AND p_type NOT LIKE 'ECONOMY PLATED%'
   AND p_size IN (24, 47, 29, 12, 18, 35, 25, 10)
   AND ps_suppkey NOT IN
   (
      SELECT
         s_suppkey
      FROM
         supplier
      WHERE
         s_comment LIKE '%Customer%Complaints%'
   )
GROUP BY
   p_brand,
   p_type,
   p_size
ORDER BY
   supplier_cnt DESC,
   p_brand,
   p_type,
   p_size
;
SELECT
   SUM(l_extendedprice) / 7.0 AS avg_yearly
FROM
   lineitem,
   part
WHERE
   p_partkey = l_partkey
   AND p_brand = 'Brand#25'
   AND p_container = 'WRAP PACK'
   AND l_quantity < (
   SELECT
      0.2 * AVG(l_quantity)
   FROM
      lineitem
   WHERE
      l_partkey = p_partkey )
;
SELECT
   SUM(l_extendedprice) / 7.0 AS avg_yearly
FROM
   lineitem,
   part
WHERE
   p_partkey = l_partkey
   AND p_brand = 'Brand#44'
   AND p_container = 'WRAP CAN'
   AND l_quantity < (
   SELECT
      0.2 * AVG(l_quantity)
   FROM
      lineitem
   WHERE
      l_partkey = p_partkey )
;
SELECT
   c_name,
   c_custkey,
   o_orderkey,
   o_orderdate,
   o_totalprice,
   SUM(l_quantity)
FROM
   customer,
   orders,
   lineitem
WHERE
   o_orderkey IN
   (
      SELECT
         l_orderkey
      FROM
         lineitem
      GROUP BY
         l_orderkey
      HAVING
         SUM(l_quantity) > 312
   )
   AND c_custkey = o_custkey
   AND o_orderkey = l_orderkey
GROUP BY
   c_name,
   c_custkey,
   o_orderkey,
   o_orderdate,
   o_totalprice
ORDER BY
   o_totalprice DESC,
   o_orderdate LIMIT 100
;
SELECT
   c_name,
   c_custkey,
   o_orderkey,
   o_orderdate,
   o_totalprice,
   SUM(l_quantity)
FROM
   customer,
   orders,
   lineitem
WHERE
   o_orderkey IN
   (
      SELECT
         l_orderkey
      FROM
         lineitem
      GROUP BY
         l_orderkey
      HAVING
         SUM(l_quantity) > 312
   )
   AND c_custkey = o_custkey
   AND o_orderkey = l_orderkey
GROUP BY
   c_name,
   c_custkey,
   o_orderkey,
   o_orderdate,
   o_totalprice
ORDER BY
   o_totalprice DESC,
   o_orderdate LIMIT 100
;
SELECT
   SUM(l_extendedprice* (1 - l_discount)) AS revenue
FROM
   lineitem,
   part
WHERE
   (
      p_partkey = l_partkey
      AND p_brand = 'Brand#11'
      AND p_container IN ('SM CASE', 'SM BOX', 'SM PACK', 'SM PKG')
      AND l_quantity >= 4
      AND l_quantity <= 4 + 10
      AND p_size BETWEEN 1 AND 5
      AND l_shipmode IN ('AIR', 'AIR REG')
      AND l_shipinstruct = 'DELIVER IN PERSON'
   )
   OR
   (
      p_partkey = l_partkey
      AND p_brand = 'Brand#33'
      AND p_container IN ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK')
      AND l_quantity >= 16
      AND l_quantity <= 16 + 10
      AND p_size BETWEEN 1 AND 10
      AND l_shipmode IN ('AIR', 'AIR REG')
      AND l_shipinstruct = 'DELIVER IN PERSON'
   )
   OR
   (
      p_partkey = l_partkey
      AND p_brand = 'Brand#34'
      AND p_container IN ('LG CASE', 'LG BOX', 'LG PACK', 'LG PKG')
      AND l_quantity >= 30
      AND l_quantity <= 30 + 10
      AND p_size BETWEEN 1 AND 15
      AND l_shipmode IN ('AIR', 'AIR REG')
      AND l_shipinstruct = 'DELIVER IN PERSON'
   )
;
SELECT
   SUM(l_extendedprice* (1 - l_discount)) AS revenue
FROM
   lineitem,
   part
WHERE
   (
      p_partkey = l_partkey
      AND p_brand = 'Brand#32'
      AND p_container IN ('SM CASE', 'SM BOX', 'SM PACK', 'SM PKG')
      AND l_quantity >= 3
      AND l_quantity <= 3 + 10
      AND p_size BETWEEN 1 AND 5
      AND l_shipmode IN ('AIR', 'AIR REG')
      AND l_shipinstruct = 'DELIVER IN PERSON'
   )
   OR
   (
      p_partkey = l_partkey
      AND p_brand = 'Brand#21'
      AND p_container IN ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK')
      AND l_quantity >= 10
      AND l_quantity <= 10 + 10
      AND p_size BETWEEN 1 AND 10
      AND l_shipmode IN ('AIR', 'AIR REG')
      AND l_shipinstruct = 'DELIVER IN PERSON'
   )
   OR
   (
      p_partkey = l_partkey
      AND p_brand = 'Brand#45'
      AND p_container IN ('LG CASE', 'LG BOX', 'LG PACK', 'LG PKG')
      AND l_quantity >= 22
      AND l_quantity <= 22 + 10
      AND p_size BETWEEN 1 AND 15
      AND l_shipmode IN ('AIR', 'AIR REG')
      AND l_shipinstruct = 'DELIVER IN PERSON'
   )
;
select s_name, s_address from supplier, nation where s_suppkey in ( select ps_suppkey from partsupp where ps_partkey in ( select p_partkey from part where p_name like 'rosy%' ) and ps_availqty > ( select 0.5 * sum(l_quantity) from lineitem where l_partkey = ps_partkey and l_suppkey = ps_suppkey and l_shipdate >= '1996-01-01 +08'::date and l_shipdate < '1996-01-01 +08'::date + interval '1' year ) ) and s_nationkey = n_nationkey and n_name = 'INDIA' order by s_name;
select s_name, s_address from supplier, nation where s_suppkey in ( select ps_suppkey from partsupp where ps_partkey in ( select p_partkey from part where p_name like 'midnight%' ) and ps_availqty > ( select 0.5 * sum(l_quantity) from lineitem where l_partkey = ps_partkey and l_suppkey = ps_suppkey and l_shipdate >= '1993-01-01 +08'::date and l_shipdate < '1993-01-01 +08'::date + interval '1' year ) ) and s_nationkey = n_nationkey and n_name = 'ETHIOPIA' order by s_name;
SELECT
   s_name,
   COUNT(*) AS numwait
FROM
   supplier,
   lineitem l1,
   orders,
   nation
WHERE
   s_suppkey = l1.l_suppkey
   AND o_orderkey = l1.l_orderkey
   AND o_orderstatus = 'F'
   AND l1.l_receiptdate > l1.l_commitdate
   AND EXISTS
   (
      SELECT
         *
      FROM
         lineitem l2
      WHERE
         l2.l_orderkey = l1.l_orderkey
         AND l2.l_suppkey <> l1.l_suppkey
   )
   AND NOT EXISTS
   (
      SELECT
         *
      FROM
         lineitem l3
      WHERE
         l3.l_orderkey = l1.l_orderkey
         AND l3.l_suppkey <> l1.l_suppkey
         AND l3.l_receiptdate > l3.l_commitdate
   )
   AND s_nationkey = n_nationkey
   AND n_name = 'CANADA'
GROUP BY
   s_name
ORDER BY
   numwait DESC,
   s_name LIMIT 100
;
SELECT
   s_name,
   COUNT(*) AS numwait
FROM
   supplier,
   lineitem l1,
   orders,
   nation
WHERE
   s_suppkey = l1.l_suppkey
   AND o_orderkey = l1.l_orderkey
   AND o_orderstatus = 'F'
   AND l1.l_receiptdate > l1.l_commitdate
   AND EXISTS
   (
      SELECT
         *
      FROM
         lineitem l2
      WHERE
         l2.l_orderkey = l1.l_orderkey
         AND l2.l_suppkey <> l1.l_suppkey
   )
   AND NOT EXISTS
   (
      SELECT
         *
      FROM
         lineitem l3
      WHERE
         l3.l_orderkey = l1.l_orderkey
         AND l3.l_suppkey <> l1.l_suppkey
         AND l3.l_receiptdate > l3.l_commitdate
   )
   AND s_nationkey = n_nationkey
   AND n_name = 'VIETNAM'
GROUP BY
   s_name
ORDER BY
   numwait DESC,
   s_name LIMIT 100
;
select cntrycode, count(*) as numcust, sum(c_acctbal) as totacctbal from ( select substring(c_phone from 1 for 2) as cntrycode, c_acctbal from customer where substring(c_phone from 1 for 2) in ('13', '10', '23', '21', '19', '34', '32') and c_acctbal > ( select avg(c_acctbal) from customer where c_acctbal > 0.00 and substring(c_phone from 1 for 2) in ('13', '10', '23', '21', '19', '34', '32') ) and not exists ( select * from orders where o_custkey = c_custkey ) ) as custsale group by cntrycode order by cntrycode;
select cntrycode, count(*) as numcust, sum(c_acctbal) as totacctbal from ( select substring(c_phone from 1 for 2) as cntrycode, c_acctbal from customer where substring(c_phone from 1 for 2) in ('15', '13', '27', '33', '21', '20', '11') and c_acctbal > ( select avg(c_acctbal) from customer where c_acctbal > 0.00 and substring(c_phone from 1 for 2) in ('15', '13', '27', '33', '21', '20', '11') ) and not exists ( select * from orders where o_custkey = c_custkey ) ) as custsale group by cntrycode order by cntrycode;
